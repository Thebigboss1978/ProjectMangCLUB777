<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Galaxy Project Manager — AlArabClub777</title>
<style>
  /* ================= GLOBAL ================= */
  :root{
    --panel-w:320px;
    --ui-bg: rgba(255,255,255,0.06);
    --glass-bg: rgba(255,255,255,0.06);
    --accent: rgba(0,200,255,0.9);
    --card-radius:12px;
    --gap:12px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:"Segoe UI",system-ui,-apple-system,Segoe,Tahoma,Roboto,"Helvetica Neue",Arial;padding:0;background:#000;color:#fff;overflow:hidden}
  header{
    position:fixed; top:0; left:0; right:0; height:56px; display:flex; align-items:center;
    justify-content:space-between; padding:8px 14px; gap:8px; z-index:60;
    backdrop-filter: blur(10px) saturate(140%); background:var(--ui-bg); border-bottom:1px solid rgba(255,255,255,0.06);
  }
  header h1{margin:0;font-size:1.05rem; display:flex; gap:8px; align-items:center}
  .toolbar{display:flex;align-items:center;gap:8px}
  .toolbar > * {height:34px; border-radius:8px; border:0; padding:0 8px; background: rgba(255,255,255,0.04); color:inherit}
  .toolbar input{min-width:220px}
  button{cursor:pointer}
  /* ================= CANVAS ================= */
  #galaxyCanvas {
    position:fixed; inset:0; z-index:1; display:block;
  }

  /* ================= EXPLORER (LEFT) ================= */
  .explorer {
    position:fixed; left:0; top:56px; bottom:24px; width:calc(100% - var(--panel-w) - 20px);
    padding:16px; overflow:auto; display:flex; flex-wrap:wrap; gap:var(--gap); align-content:flex-start; z-index:40;
    -webkit-overflow-scrolling:touch;
  }
  /* card */
  .card {
    width:140px; background: rgba(5,8,12,0.45); border-radius:var(--card-radius); padding:8px;
    display:flex; flex-direction:column; align-items:center; text-align:center; gap:6px;
    transition: transform .15s ease, box-shadow .15s ease; cursor:pointer; user-select:none;
    border:1px solid rgba(255,255,255,0.03);
  }
  .card:hover{ transform:translateY(-6px) scale(1.03); box-shadow:0 10px 30px rgba(0,200,255,0.08) }
  .card-thumb{ width:100%; height:88px; border-radius:8px; object-fit:cover; background:linear-gradient(180deg,#111,#222) }
  .card-label{ font-size:.85rem; white-space:nowrap; text-overflow:ellipsis; overflow:hidden; width:100% }

  /* list mode */
  .listItem {
    width:100%; display:flex; justify-content:space-between; align-items:center; gap:8px;
    padding:10px 12px; border-radius:10px; background: rgba(255,255,255,0.02); transition:background .12s;
  }
  .listItem:hover{ background: rgba(0,200,255,0.04) }

  /* ================= PREVIEW (RIGHT PANEL) ================= */
  #previewPanel {
    position:fixed; right:0; top:56px; bottom:24px; width:var(--panel-w); padding:12px; z-index:50;
    background: linear-gradient(180deg, rgba(0,0,0,0.42), rgba(0,0,0,0.35));
    border-left:1px solid rgba(255,255,255,0.04); display:flex; flex-direction:column; gap:8px; border-radius:0 0 0 0;
    backdrop-filter: blur(8px) saturate(140%);
  }
  #previewHeader { font-weight:700; font-size:0.95rem; padding-bottom:6px; border-bottom:1px solid rgba(255,255,255,0.03) }
  #previewMeta{ font-size:0.78rem; color:rgba(255,255,255,0.7) }
  #viewer { flex:1; overflow:auto; display:flex; align-items:center; justify-content:center; padding:8px }
  #viewer img, #viewer video, #viewer iframe { max-width:100%; max-height:60vh; border-radius:10px; display:block; }
  #previewActions{ display:flex; gap:8px; padding-top:6px }
  #previewActions button{ flex:1; height:36px; border-radius:8px; background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); border:1px solid rgba(255,255,255,0.04) }

  /* ================= FOOTER (tiny) ================= */
  footer { position:fixed; left:0; right:0; bottom:0; height:24px; z-index:60; display:flex; align-items:center; justify-content:center; font-size:12px; color:rgba(255,255,255,0.6);
    background: linear-gradient(0deg, rgba(0,0,0,0.24), rgba(0,0,0,0.16));
    border-top:1px solid rgba(255,255,255,0.02);
  }

  /* ================= GLASSY THEME FIX ================= */
  .glassyMode header{ background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); }
  .glassyMode .explorer, .glassyMode #previewPanel {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    backdrop-filter: blur(8px) saturate(160%);
    border:1px solid rgba(255,255,255,0.03);
  }

  /* responsive */
  @media (max-width:900px){
    .explorer{ width: calc(100% - 20px); top:56px; left:0; right:0; bottom: 220px; padding:12px; }
    #previewPanel{ position:fixed; right:12px; left:12px; bottom:12px; top:auto; height:200px; width:auto; border-left:0; border-radius:12px }
    #viewer img, #viewer video, #viewer iframe { max-height: 36vh }
  }
</style>
</head>
<body>

<header>
  <h1>🌌 Galaxy Portal — AlArabClub777</h1>
  <div class="toolbar">
    <button id="pickFolder">📁 اختر مجرة</button>
    <select id="viewMode" title="View mode"><option value="grid">Grid</option><option value="card">Card</option><option value="list">List</option></select>
    <input id="search" placeholder="🔎 بحث (type:, ext:, name:)" />
    <select id="theme"><option value="dark">Dark</option><option value="glassy">Glassy</option><option value="light">Light</option></select>
  </div>
</header>

<canvas id="galaxyCanvas"></canvas>

<!-- Explorer (left/main) -->
<section class="explorer" id="explorer"></section>

<!-- Preview (right) -->
<aside id="previewPanel">
  <div id="previewHeader">معاينة الملف</div>
  <div id="previewMeta">لا شيء محدد</div>
  <div id="viewer">اختر ملفاً من اليسار</div>
  <div id="previewActions">
    <button id="openBtn">فتح</button>
    <button id="downloadBtn">تحميل</button>
    <button id="copyBtn">نسخ الاسم</button>
  </div>
</aside>

<footer>🌐 AlArabClub777 — العرّاب ©️ 2025</footer>

<script>
/* ========= Globals & Utilities ========= */
const canvas = document.getElementById('galaxyCanvas');
const ctx = canvas.getContext('2d', { alpha: true });
const explorer = document.getElementById('explorer');
const viewer = document.getElementById('viewer');
const previewMeta = document.getElementById('previewMeta');
const previewHeader = document.getElementById('previewHeader');

let files = [];            // {name,type,size,handle,color}
let stars = [];            // particle objects linked to files
let current = null;
let viewMode = 'grid';
let theme = 'dark';
let mouse = { x: window.innerWidth/2, y: window.innerHeight/2 };
let portalPulse = 0;
let portalPulseTarget = 0;

/* resize */
function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

/* color map utility */
function colorForFile(f){
  if(f.type.startsWith('image')) return 'rgba(0,200,255,0.95)';
  if(f.type.startsWith('video')) return 'rgba(170,80,255,0.95)';
  if(f.name.endsWith('.pdf')) return 'rgba(255,70,70,0.95)';
  if(f.name.endsWith('.html') || f.type === 'text/html') return 'rgba(255,140,60,0.95)';
  return 'rgba(140,140,160,0.95)';
}

/* ========== File Picker & Loading ========== */
document.getElementById('pickFolder').addEventListener('click', async () => {
  try{
    const dir = await window.showDirectoryPicker();
    files = [];
    for await (const entry of dir.values()){
      if(entry.kind === 'file'){
        const fileData = await entry.getFile();
        files.push({
          name: fileData.name,
          size: fileData.size,
          type: fileData.type || 'unknown',
          handle: entry,
          color: colorForFile(fileData)
        });
      }
    }
    initStars();
    renderExplorer();
    // subtle portal pulse to indicate load
    portalPulseTarget = 1.4;
  } catch(err){
    console.warn('picker canceled or unsupported', err);
  }
});

/* ========== Stars Initialization ========== */
function initStars(){
  stars = files.map(f => ({
    file: f,
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    r: 6 + Math.random() * 6,
    vx: (Math.random()-0.5) * 0.5,
    vy: (Math.random()-0.5) * 0.5,
    color: f.color
  }));
}

/* ========== Canvas Galaxy Animation (Hyper) ========== */
function drawGalaxy(){
  // fade background slightly for trails
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // portal center + pulse (damped target)
  portalPulse += (portalPulseTarget - portalPulse) * 0.08;
  portalPulseTarget *= 0.95;

  const cx = canvas.width/2, cy = canvas.height/2;
  const baseR = 80 + Math.sin(performance.now()/900) * 20;
  const pr = baseR * (1 + portalPulse*0.25);

  // outer glow
  const g = ctx.createRadialGradient(cx,cy,pr*0.2,cx,cy,pr*1.6);
  g.addColorStop(0, 'rgba(0,200,255,' + (0.35 + portalPulse*0.18) + ')');
  g.addColorStop(0.6, 'rgba(20,20,40,0.06)');
  g.addColorStop(1, 'transparent');
  ctx.fillStyle = g;
  ctx.beginPath(); ctx.arc(cx,cy, pr*1.3, 0, Math.PI*2); ctx.fill();

  // subtle rotating rings
  ctx.save();
  ctx.translate(cx,cy);
  ctx.rotate(performance.now()/12000);
  ctx.strokeStyle = 'rgba(255,255,255,0.03)';
  ctx.lineWidth = 1;
  ctx.beginPath(); ctx.arc(0,0, pr*0.6, 0, Math.PI*2); ctx.stroke();
  ctx.beginPath(); ctx.arc(0,0, pr*0.95, 0, Math.PI*2); ctx.stroke();
  ctx.restore();

  // update+draw stars
  for(let s of stars){
    // attraction to hovered explorer card center(s)
    const hovered = document.querySelectorAll('.card:hover, .listItem:hover');
    if(hovered.length){
      hovered.forEach(h => {
        const rect = h.getBoundingClientRect();
        // convert rect center into canvas coordinate space (page coords vs canvas)
        const tx = rect.left + rect.width/2;
        const ty = rect.top + rect.height/2;
        // small attraction
        const dx = tx - s.x;
        const dy = ty - s.y;
        const dist = Math.hypot(dx,dy);
        if(dist < 280){
          s.vx += (dx / dist) * 0.03;
          s.vy += (dy / dist) * 0.03;
        }
      });
    }

    // attraction to mouse for subtle following
    const mdx = mouse.x - s.x;
    const mdy = mouse.y - s.y;
    const mdist = Math.hypot(mdx,mdy);
    if(mdist < 180){
      s.vx += (mdx / mdist) * 0.02;
      s.vy += (mdy / mdist) * 0.02;
    }

    // damping & movement
    s.vx *= 0.96; s.vy *= 0.96;
    s.x += s.vx;
    s.y += s.vy;

    // simple bounds
    if(s.x < 4) { s.x = 4; s.vx *= -0.6 }
    if(s.x > canvas.width-4) { s.x = canvas.width-4; s.vx *= -0.6 }
    if(s.y < 4) { s.y = 4; s.vy *= -0.6 }
    if(s.y > canvas.height-4) { s.y = canvas.height-4; s.vy *= -0.6 }

    // particle trail (tiny)
    ctx.beginPath();
    ctx.fillStyle = s.color;
    ctx.shadowBlur = 10;
    ctx.shadowColor = s.color;
    ctx.arc(s.x, s.y, s.r * 0.9, 0, Math.PI*2);
    ctx.fill();
    ctx.shadowBlur = 0;
  }

  requestAnimationFrame(drawGalaxy);
}
requestAnimationFrame(drawGalaxy);

/* ========== Interaction: Mouse tracking ========== */
window.addEventListener('mousemove', (e) => {
  mouse.x = e.clientX;
  mouse.y = e.clientY;
  // when mouse near portal center, boost portal glow
  const cx = window.innerWidth/2;
  const cy = window.innerHeight/2;
  const d = Math.hypot(e.clientX - cx, e.clientY - cy);
  // closer -> stronger
  portalPulseTarget = Math.max(portalPulseTarget, Math.max(0, 1.0 - (d / Math.max(window.innerWidth, window.innerHeight)) ) * 0.8);
});

/* ========== Explorer rendering & thumbnails (silent video autoplay) ========== */
document.getElementById('viewMode').addEventListener('change', (e)=>{
  viewMode = e.target.value;
  renderExplorer();
});

async function renderExplorer(filtered = files){
  explorer.innerHTML = '';
  if(filtered.length === 0){
    const hint = document.createElement('div');
    hint.style.color = 'rgba(255,255,255,0.55)';
    hint.textContent = 'اضغط "اختر مجرة" لفتح مجلد على جهازك.';
    explorer.appendChild(hint);
    return;
  }

  for(const f of filtered){
    if(viewMode === 'list'){
      const li = document.createElement('div');
      li.className = 'listItem';
      li.innerHTML = `<div style="max-width:70%">${escapeHtml(f.name)}</div><div style="color:rgba(255,255,255,0.6)">${(f.size/1024).toFixed(1)} KB</div>`;
      li.addEventListener('click', ()=> openPreview(f));
      explorer.appendChild(li);
      continue;
    }

    const card = document.createElement('div');
    card.className = 'card';

    // create thumbnail element depending on type
    try{
      if(f.type.startsWith('image')){
        const img = document.createElement('img');
        img.className = 'card-thumb';
        const blob = await f.handle.getFile();
        img.src = URL.createObjectURL(blob);
        card.appendChild(img);
      } else if(f.type.startsWith('video')){
        const v = document.createElement('video');
        v.className = 'card-thumb';
        v.muted = true; v.autoplay = true; v.loop = true; v.playsInline = true;
        const blob = await f.handle.getFile();
        v.src = URL.createObjectURL(blob);
        // ensure autoplay works: muted true
        card.appendChild(v);
      } else {
        // generic icon box
        const box = document.createElement('div');
        box.className = 'card-thumb';
        box.style.display = 'flex';
        box.style.alignItems = 'center';
        box.style.justifyContent = 'center';
        box.style.fontSize = '12px';
        box.style.color = 'rgba(255,255,255,0.7)';
        box.textContent = extLabel(f.name);
        card.appendChild(box);
      }
    } catch(err){
      const box = document.createElement('div');
      box.className = 'card-thumb';
      box.textContent = 'ERR';
      card.appendChild(box);
    }

    const label = document.createElement('div');
    label.className = 'card-label';
    label.textContent = f.name;
    card.appendChild(label);

    card.addEventListener('click', ()=> openPreview(f));
    explorer.appendChild(card);
  }
}

/* tiny helper: escape html */
function escapeHtml(s){ return s.replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c]) }
function extLabel(name){ return name.split('.').pop().toUpperCase(); }

/* ========== Smart Search ========== */
document.getElementById('search').addEventListener('input', (e)=>{
  const q = e.target.value.trim().toLowerCase();
  if(!q) return renderExplorer(files);
  const filtered = files.filter(f => {
    if(q.startsWith('type:')) return f.type.includes(q.slice(5));
    if(q.startsWith('ext:')) return f.name.toLowerCase().endsWith(q.slice(4));
    return f.name.toLowerCase().includes(q);
  });
  renderExplorer(filtered);
});

/* ========== Preview panel behavior ========== */
async function openPreview(f){
  current = f;
  previewHeader.textContent = f.name;
  previewMeta.textContent = `${(f.size/1024).toFixed(1)} KB — ${f.type || 'unknown'}`;
  viewer.innerHTML = '';
  // pulse portal stronger when opening
  portalPulseTarget = Math.max(portalPulseTarget, 1.8);

  try{
    const file = await f.handle.getFile();
    if(f.type.startsWith('image')){
      const img = document.createElement('img'); img.src = URL.createObjectURL(file); viewer.appendChild(img);
    } else if(f.type.startsWith('video')){
      const v = document.createElement('video'); v.src = URL.createObjectURL(file); v.controls = true; v.muted = true; v.autoplay = false; v.playsInline = true; viewer.appendChild(v);
    } else if(f.name.endsWith('.html') || f.type === 'text/html'){
      const txt = await file.text();
      const iframe = document.createElement('iframe'); iframe.srcdoc = txt; iframe.width='100%'; iframe.height='420'; viewer.appendChild(iframe);
    } else if(f.name.endsWith('.pdf')){
      const blobUrl = URL.createObjectURL(file);
      const iframe = document.createElement('iframe'); iframe.src = blobUrl; iframe.width='100%'; iframe.height='420'; viewer.appendChild(iframe);
    } else {
      // text or unknown: show text content if small
      try{
        const txt = await file.text();
        const pre = document.createElement('pre'); pre.style.whiteSpace='pre-wrap'; pre.style.fontSize='13px'; pre.textContent = txt.slice(0, 20000); viewer.appendChild(pre);
      }catch(err){
        viewer.textContent = '📄 لا توجد معاينة متاحة';
      }
    }
  } catch(err){
    viewer.textContent = '❌ خطأ في المعاينة';
    console.error(err);
  }
}

/* ========== Preview buttons actions ========== */
document.getElementById('openBtn').addEventListener('click', ()=>{
  if(!current) return alert('اختر ملفًا أولاً');
  // open a blank window (can't open local blob in new tab reliably across browsers)
  const w = window.open();
  w.document.write(`<pre style="white-space:pre-wrap;font-family:monospace;">${escapeHtml(current.name)}</pre>`);
});

document.getElementById('downloadBtn').addEventListener('click', async ()=>{
  if(!current) return alert('اختر ملفًا أولاً');
  const file = await current.handle.getFile();
  const a = document.createElement('a'); a.href = URL.createObjectURL(file); a.download = current.name; a.click();
});

document.getElementById('copyBtn').addEventListener('click', async ()=>{
  if(!current) return alert('اختر ملفًا أولاً');
  await navigator.clipboard.writeText(current.name);
  alert('تم نسخ الاسم: ' + current.name);
});

/* ========== Theme switcher ========== */
document.getElementById('theme').addEventListener('change', (e)=>{
  theme = e.target.value;
  if(theme === 'glassy'){
    document.documentElement.classList.add('glassyMode');
  } else {
    document.documentElement.classList.remove('glassyMode');
  }
  if(theme === 'light'){
    document.body.style.background = '#f5f6f8'; document.body.style.color = '#111';
  } else {
    document.body.style.background = '#000'; document.body.style.color = '#fff';
  }
});

/* ========== Init tiny demo files (if user hasn't picked any) ========= */
(function seedDemo(){
  // small demo files array so UI isn't empty on first load
  files = [
    { name: 'صورة-تجريبية.png', size: 90000, type: 'image/png', handle: null, color: 'rgba(0,200,255,0.95)' },
    { name: 'فيديو-تجريبي.mp4', size: 340000, type: 'video/mp4', handle: null, color: 'rgba(170,80,255,0.95)' },
    { name: 'مستند.pdf', size: 120000, type: 'application/pdf', handle: null, color: 'rgba(255,70,70,0.95)' },
    { name: 'صفحة.html', size: 8000, type: 'text/html', handle: null, color: 'rgba(255,140,60,0.95)' }
  ];
  // For demo cards, we won't attempt to load blobs (handles null); thumbnails will show ext label.
  initStars();
  renderExplorer();
})();

/* ========== Small helpers for demo/null handles: show ext if no blob ========= */
function isHandleValid(f){ return f && f.handle && typeof f.handle.getFile === 'function'; }

/* Ensure renderExplorer can handle missing handle (demo) */
async function renderExplorerWrapper(){
  await renderExplorer(files);
}

/* Kick off proper render */
renderExplorerWrapper();

/* Optional: press / key shortcuts */
window.addEventListener('keydown', (e)=>{
  if(e.key === 'f') document.getElementById('pickFolder').click();
});
</script>
</body>
</html>